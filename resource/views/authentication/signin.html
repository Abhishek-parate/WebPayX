<!DOCTYPE html>
<html lang="en">

{% block head %}
{% include 'components/head.html' %}
{% endblock %}

<body class="dark:bg-neutral-800 bg-neutral-100 dark:text-white">

    <section class="bg-white dark:bg-dark-2 flex flex-wrap min-h-[100vh]">
        <div class="lg:w-1/2 lg:block hidden">
            <div class="flex items-center flex-col h-full justify-center">
                <img src="{{ url_for('static', filename='assets/images/auth/auth-img.png') }}" alt="Authentication Image">
            </div>
        </div>
        <div class="lg:w-1/2 py-8 px-6 flex flex-col justify-center">
            <div class="lg:max-w-[464px] mx-auto w-full">
                <div>
                    <a href="{{ url_for('dashboard.index') }}" class="mb-2.5 max-w-[250px]">
                        <img src="{{ url_for('static', filename='assets/images/logo.png') }}" alt="Logo" class="mb-2.5 max-w-96">
                    </a>
                    <h4 class="mb-3 text-success-600">Sign In to your Account</h4>
                    <p class="mb-8 text-lg">Welcome back! please enter your detail</p>
                </div>

                <!-- Display Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} mb-4 p-4 rounded-xl border-l-4 
                                        {% if category == 'error' %}bg-red-50 border-red-500 text-red-700 dark:bg-red-900 dark:border-red-600 dark:text-red-300{% elif category == 'success' %}bg-green-50 border-green-500 text-green-700 dark:bg-green-900 dark:border-green-600 dark:text-green-300{% else %}bg-blue-50 border-blue-500 text-blue-700 dark:bg-blue-900 dark:border-blue-600 dark:text-blue-300{% endif %}">
                                <div class="flex items-center">
                                    <iconify-icon icon="{% if category == 'error' %}material-symbols:error{% elif category == 'success' %}material-symbols:check-circle{% else %}material-symbols:info{% endif %}" class="text-lg mr-2"></iconify-icon>
                                    {{ message }}
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Login Form -->
                <form method="POST" action="{{ url_for('authentication.login_page') }}" id="loginForm">
                    <input type="hidden" name="step" value="credentials">
                    
                    <!-- Tenant Code Field (Hidden or Optional) -->
                    <input type="hidden" name="tenant_code" value="DEFAULT">
                    
                    <!-- Username/Email/Phone Field -->
                    <div class="icon-field mb-4 relative">
                        <span class="absolute start-4 top-1/2 -translate-y-1/2 pointer-events-none flex text-xl">
                            <iconify-icon icon="mage:email"></iconify-icon>
                        </span>
                        <input type="text" 
                               name="username" 
                               id="username"
                               class="form-control h-[56px] ps-11 border-neutral-300 bg-neutral-50 dark:bg-dark-2 rounded-xl focus:!border-green-500 focus:!ring-1 focus:!ring-green-500 hover:!border-green-500 hover:!shadow-lg hover:!shadow-green-100 transition-all duration-300 ease-in-out" " 
                               placeholder="Username, Email or Phone"
                               required
                               value="{{ request.form.username if request.form.username }}">
                    </div>

                    <!-- Password Field -->
                    <div class="relative mb-5">
                        <div class="icon-field">
                            <span class="absolute start-4 top-1/2 -translate-y-1/2 pointer-events-none flex text-xl">
                                <iconify-icon icon="solar:lock-password-outline"></iconify-icon>
                            </span>
                            <input type="password" 
                                   name="password" 
                                   id="your-password"
                                   class="form-control h-[56px] ps-11 border-neutral-300 bg-neutral-50 dark:bg-dark-2 rounded-xl focus:!border-green-500 focus:!ring-1 focus:!ring-green-500 hover:!border-green-500 transition-all duration-300" 
                                   placeholder="Password"
                                   required>
                        </div>
                        <span class="toggle-password ri-eye-line cursor-pointer absolute end-0 top-1/2 -translate-y-1/2 me-4 text-secondary-light" data-toggle="#your-password"></span>
                    </div>

                    <!-- Remember Me and Forgot Password -->
                    <div class="mt-7">
                        <div class="flex justify-between gap-2">
                            <div class="flex items-center">
                                <input class="form-check-input border border-neutral-300 hover:!border-green-500 focus:!ring-green-500" 
                                       type="checkbox" 
                                       name="remember_me"
                                       value="1" 
                                       id="remember">
                                <label class="ps-2 text-success-600" for="remember">Remember me</label>
                            </div>
                            <a href="{{ url_for('authentication.forgot_password_page') }}" class="text-success-600 font-medium hover:underline">Forgot Password?</a>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" 
                            id="loginBtn"
                            class="bg-green-600 hover:bg-green-700 justify-center text-md btn-sm px-3 py-4 w-full rounded-xl mt-8 flex items-center text-white transition-colors duration-300">
                        <span class="loading-spinner hidden mr-2">
                            <iconify-icon icon="eos-icons:loading" class="animate-spin"></iconify-icon>
                        </span>
                        <span class="btn-text">Sign In</span>
                    </button>

                    <!-- Demo Credentials Section -->
                    <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-xl border hover:border-green-500 transition-colors duration-300">
                        <div class="flex items-center justify-between">
                            <div>
                                <h6 class="text-sm font-semibold mb-1">Demo Credentials</h6>
                                <p class="text-xs text-gray-600 dark:text-gray-300">
                                    <strong>Username:</strong> superadmin<br>
                                    <strong>Password:</strong> Admin@123
                                </p>
                            </div>
                            <button type="button" 
                                    class="btn btn-outline-primary btn-sm px-3 py-2 text-xs hover:bg-green-500 hover:border-green-500 transition-colors duration-300"
                                    onclick="fillDemoCredentials()">
                                <iconify-icon icon="material-symbols:auto-fix-high" class="mr-1"></iconify-icon>
                                Use Demo
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>

    {% block script %}
    {% include 'components/script.html' %}
    {% endblock %}

    {% block custom_script %}
    <script>
        // ================== Password Show Hide Js Start ==========
        function initializePasswordToggle(toggleSelector) {
            $(toggleSelector).on("click", function() {
                $(this).toggleClass("ri-eye-off-line");
                var input = $($(this).attr("data-toggle"));
                if (input.attr("type") === "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            });
        }
        // Call the function
        initializePasswordToggle(".toggle-password");

        // ================== Demo Credentials Function ==========
        function fillDemoCredentials() {
            document.getElementById('username').value = 'superadmin';
            document.getElementById('your-password').value = 'Admin@123';
            
            // Add visual feedback
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<iconify-icon icon="material-symbols:check" class="mr-1"></iconify-icon>Filled!';
            btn.classList.add('btn-success');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('btn-success');
            }, 2000);
        }

        // ================== Form Submission Handling ==========
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            const loginBtn = document.getElementById('loginBtn');
            const spinner = loginBtn.querySelector('.loading-spinner');
            const btnText = loginBtn.querySelector('.btn-text');
            
            // Show loading state
            spinner.classList.remove('hidden');
            btnText.textContent = 'Signing In...';
            loginBtn.disabled = true;
            
            // Re-enable button after 10 seconds (in case of no response)
            setTimeout(function() {
                spinner.classList.add('hidden');
                btnText.textContent = 'Sign In';
                loginBtn.disabled = false;
            }, 10000);
        });

        // ================== Social Login Placeholder ==========
        function socialLogin(provider) {
            alert(`${provider.charAt(0).toUpperCase() + provider.slice(1)} login integration coming soon!`);
        }

        // ================== Auto-focus and Enter Key Handling ==========
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-focus on username field
            document.getElementById('username').focus();
            
            // Handle Enter key in password field
            document.getElementById('your-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginForm').submit();
                }
            });
        });

        // ================== Alert Auto-hide ==========
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                if (alert.classList.contains('alert-success')) {
                    setTimeout(function() {
                        alert.style.transition = 'opacity 0.5s ease-in-out';
                        alert.style.opacity = '0';
                        setTimeout(function() {
                            alert.remove();
                        }, 500);
                    }, 5000);
                }
            });
        });
    </script>
    {% endblock %}

</body>
</html>
